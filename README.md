# prm_sim
A ROS Probabilistic Road Map Simulator.

## Rationale

The probabilistic roadmap planner is a motion-planning algorithm in robotics, which solves the problem of determining a path between a starting and a goal configuration of the robot while avoiding collisions.

The basic idea behind PRM is to take random samples from the configuration space of the robot, checking if they are in free space, then attempting to connect configurations (groups of samples) to other nearby configurations.

### Low Dispersion Probablistic Roadmaps

This implementation uses LD-PRM planning. The idea behind LD-PRM is to capture the connectivity of the configuration space with fewer samples, which reduces the running time of the algorithm. Different to a simple PRM planner, the samples generated by the LD-PRM must fufil an important criterion in order to be included inside the roadmap. Samples are forbidden to be close to each other more than a predefined radius.

This criterion creates an almost uniform distribution of samples. As the PRM network increases in size, the speration radius decreases, and the network better captures the entire form of the free configuration space. This helps to capture the connectivity of narrow passages, which present significant challenges in other PRM implementations.

Khaksar, W. Hong, T. Khaksar, M. Motlagh, O. 2013, "A Low Dispersion Probabilistic Roadmaps (LD-PRM) Algorithm for Fast and Efficient Sampling-Based Motion Planning", International Journal of Advanced Robotic Systems, Vol.10, [link](http://cdn.intechopen.com/pdfs/45913.pdf)

## Running the simulator
### Starting the ROS nodes

After starting `roscore` the following nodes must be started:

- World map: `rosrun stage_ros stageros $(rospack find prm_sim)/worlds/uoa_robotics_lab.world`
- Convert world map to ogMap: `rosrun local_map local_map /local_map/scan:=/base_scan_1 _map_width:=200 _map_height:=200 _map_resolution:=0.1`
- Convert ogMap to openCV image: `rosrun prm_sim prm_sim_image_node map:=/local_map/local_map /pose:=/odom`
- The PRM simulator: `rosrun prm_sim prm_sim_node`

One might want to additionally visualise the produced prm network and the robot's configuration space. To do so, the following commands can be run:
- Visualisation of robot pose, map space and line of sight: `rosrun rviz rviz -d $(rospack find prm_sim)/rviz/pfms.rviz`
- Visualisation of the prm network and path: `rqt_image_view` (looking at topic `/prm`)

For convenience, the `start.sh` script will run all the above nodes in new terminals when executed (the rqt_image_view is not included).

### Requesting goals

To find a path from the robot's position to a given goal, the following service `rosservice call /request_goal -- 1.2 0.0` can be used. When requesting a goal, x and y coordinates are rounded to one decimal place. Note that goals outside of the configuration space, or in unknown areas, will be dumped.

## Building

When first building the project, run `catkin_make -j1` (in the catkin workspace) to auto-generate the src from the srv file. After that initial build, calls to `catkin_make` will suffice.

//TODO: Installation instructions

## Testing

This project also comes with a series of unit tests that are run on a gtest framework. To build these tests run `catkin_make tests` from the catkin workspace. To run these tests simply run `./devel/lib/prm_sim/prm_sim-test` from the catkin workspace.

It is important to note that due to the non-deterministic behaviour of prm network building, there is a chance some of the unit tests could fail. To visualise the generation of the prm networks during unit testing, pass `--show` as a command line argument. To increase or decrease the amount of prm building rounds (default is ten) during unit testing, pass `-t <max_rounds>` as a command line argument.
